# OrbitScore プロジェクトレビューガイドライン

## 🌐 言語設定

**レビューコメントは必ず日本語で記述してください。**

- すべてのコメント、説明、提案は日本語で行う
- 技術用語は英語のまま使用可（例: SuperCollider, SynthDef, TypeScript）
- コード例は英語のまま
- 理由: このプロジェクトの開発者は日本語話者であり、日本語でのコミュニケーションが最も効率的

## プロジェクト概要

OrbitScoreは、度数ベースの音楽DSLを持つライブコーディング用オーディオエンジンです。SuperColliderとの統合、カスタムDSL、VS Code拡張機能を含みます。

## セキュリティの重点領域

- **SuperColliderサーバーとの通信**: OSCメッセージの検証とエラーハンドリング
- **ファイル操作**: オーディオファイルパスの検証とサニタイゼーション
- **プロセス管理**: SuperColliderプロセスの適切な起動・終了処理

## アーキテクチャパターン

### DSL設計
- **度数0は休符**: 音楽的な沈黙を表す重要な概念
- **度数1-12**: 半音階（C, C#, D, D#, E, F, F#, G, G#, A, A#, B）
- **小数第3位まで**: 精度の維持（3 decimal places）

### コード構造
- **モノレポ構成**: `packages/`配下にengine, parser, vscode-extensionを配置
- **TypeScript**: 厳格な型定義、デフォルトエクスポート禁止
- **テスト**: `tests/<module>/<feature>.spec.ts`の命名規則

### SuperCollider統合
- **SynthDef管理**: `packages/engine/supercollider/synthdefs/`に配置
- **オーディオデバイス**: 入力/出力/duplexの明確な分類
- **エラーハンドリング**: SuperColliderサーバーの起動失敗、SynthDef読み込みエラーの適切な処理

## コーディング規約

### TypeScript
- **明示的なエクスポート**: デフォルトエクスポート禁止
- **型定義**: すべての関数に戻り値の型を明記
- **定数使用**: マジックナンバー禁止、定数を使用

### 命名規則
- **関数**: camelCase
- **クラス**: PascalCase
- **定数**: UPPER_SNAKE_CASE
- **ファイル**: kebab-case

### ドキュメント
- **仕様書**: `docs/INSTRUCTION_ORBITSCORE_DSL.md`が最新のDSL仕様（v2.0）
- **実装計画**: `docs/IMPLEMENTATION_PLAN.md`でフェーズ管理
- **作業ログ**: `docs/WORK_LOG.md`は全コミットで更新必須

## よくある問題

### DSL関連
- **度数0の扱い**: 休符として正しく処理されているか確認
- **未定義メソッド**: 仕様書にないメソッドの追加（例: `config()`, `offset()`）
- **メソッドチェーン**: 仕様書で定義されたメソッドのみ使用

### SuperCollider関連
- **SynthDef未定義**: 使用前にSynthDefが読み込まれているか確認
- **オーディオデバイス**: デバイスIDの検証とエラーハンドリング
- **メモリリーク**: SuperColliderプロセスの適切なクリーンアップ

### テスト関連
- **ゴールデンファイル**: 回帰テスト用のゴールデンファイルの更新忘れ
- **非同期処理**: SuperColliderとの通信における適切なawait/Promise処理
- **テストの独立性**: 各テストが独立して実行可能か確認

## レビュー時の注意点

### 必須確認事項
1. **仕様書との整合性**: `docs/INSTRUCTION_ORBITSCORE_DSL.md`に準拠しているか
2. **テストの追加**: 新機能に対応するテストが追加されているか
3. **ドキュメント更新**: README.md、WORK_LOG.mdが更新されているか
4. **型安全性**: TypeScriptの型定義が適切か

### パフォーマンス
- **オーディオバッファ**: 適切なバッファサイズとレイテンシ
- **メモリ使用**: 長時間実行時のメモリリーク
- **SuperCollider負荷**: 過度なOSCメッセージ送信の回避

### ライブコーディング特有の考慮事項
- **実行時エラー**: ライブパフォーマンス中のエラーハンドリング
- **状態管理**: グローバル状態の適切な管理
- **リアルタイム性**: オーディオ再生のタイミング精度

## 除外項目

以下は自動レビューの対象外としてください：
- **アーカイブファイル**: `docs/archive/`配下のファイル
- **生成ファイル**: `dist/`, `build/`, `*.scsyndef`
- **テストアセット**: `test-assets/`配下のオーディオファイル
- **一時ファイル**: `tmp/`配下のファイル

## 参考リンク

- [DSL仕様書](../docs/INSTRUCTION_ORBITSCORE_DSL.md)
- [実装計画](../docs/IMPLEMENTATION_PLAN.md)
- [プロジェクトルール](../docs/PROJECT_RULES.md)
