# Cursor でのOrbitScore拡張テスト手順

## 事前準備

1. ✅ 拡張がインストール済み
2. エンジンがビルド済み（`packages/engine/dist/cli.js`が存在）

## テスト手順

### Step 1: テストファイルを開く

Cursorで以下のファイルを開いてください：
```
examples/performance-test-simple.osc
```

### Step 2: 構文ハイライトの確認

- ファイルが`.osc`拡張子で認識されているか確認
- キーワード（`var`, `init`, `GLOBAL`）が色付けされているか確認
- メソッド名（`tempo`, `beat`, `play`）が色付けされているか確認

### Step 3: オートコンプリートのテスト

新しい行で以下を試してください：
1. `global.` と入力 → `tempo()`, `beat()`, `run()` などが提案されるか確認
2. `kick.` と入力 → `play()`, `audio()`, `mute()` などが提案されるか確認

### Step 4: Cmd+Enter機能のテスト

#### テスト 4-1: グローバル初期化
1. 以下の3行を選択：
```osc
var global = init GLOBAL
global.tempo(120)
global.beat(4 by 4)
```
2. **Cmd+Enter**を押す
3. **期待される結果**:
   - 出力パネルが開く
   - "Code executed successfully" または実行ログが表示される
   - エラーが出ないこと

#### テスト 4-2: キックドラムの追加
1. 以下の行を選択：
```osc
var kick = init global.seq
kick.beat(4 by 4).length(1)
kick.audio("../test-assets/audio/kick.wav").chop(1)
kick.play(1, 0, 1, 0)
kick.run()
```
2. **Cmd+Enter**を押す
3. **期待される結果**:
   - キックドラムの音が聞こえる
   - 4分音符で2回鳴る（1拍目と3拍目）

#### テスト 4-3: ハイハットの追加
1. 以下の行を選択：
```osc
var hihat = init global.seq
hihat.beat(4 by 4).length(1)
hihat.audio("../test-assets/audio/hihat.wav").chop(1)
hihat.play(1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0)
hihat.run()
```
2. **Cmd+Enter**を押す
3. **期待される結果**:
   - ハイハットの音が聞こえる
   - キックドラムと同時に鳴り続ける

#### テスト 4-4: リアルタイムパターン変更
1. キックとハイハットが鳴っている状態で以下を選択：
```osc
kick.play(1, 0, 0, 1, 0, 1, 0, 0)
```
2. **Cmd+Enter**を押す
3. **期待される結果**:
   - キックのパターンがブレイクビーツ風に変わる
   - 音が途切れない

#### テスト 4-5: テンポ変更
1. 以下を選択：
```osc
global.tempo(140)
```
2. **Cmd+Enter**を押す
3. **期待される結果**:
   - 全体のテンポが速くなる
   - スムーズに切り替わる

#### テスト 4-6: ミュート/アンミュート
1. 以下を選択：
```osc
hihat.mute()
```
2. **Cmd+Enter**を押す
3. **期待される結果**:
   - ハイハットの音が止まる
   - キックは鳴り続ける

4. 以下を選択：
```osc
hihat.unmute()
```
5. **Cmd+Enter**を押す
6. **期待される結果**:
   - ハイハットが再び鳴り始める

#### テスト 4-7: 停止
1. 以下を選択：
```osc
global.stop()
```
2. **Cmd+Enter**を押す
3. **期待される結果**:
   - すべての音が停止する

## トラブルシューティング

### 問題: Cmd+Enterを押しても何も起こらない

**確認項目**:
1. ファイルが`.osc`拡張子で保存されているか
2. 拡張が有効化されているか（Cursor再起動）
3. キーバインドが正しく設定されているか

**解決策**:
- Cursorを再起動
- コマンドパレット（Cmd+Shift+P）で "OrbitScore: Run Selection" を手動実行

### 問題: "Engine not found" エラー

**原因**: エンジンがビルドされていない

**解決策**:
```bash
cd packages/engine
npm run build
```

### 問題: オーディオが聞こえない

**確認項目**:
1. オーディオファイルが存在するか（`test-assets/audio/kick.wav`等）
2. システムの音量設定
3. 出力パネルにエラーメッセージがないか

**解決策**:
- オーディオファイルのパスを確認
- 絶対パスで試してみる

### 問題: パーサーエラー

**よくあるエラー**:
- "Unknown character '=' at line X"
  → コメント形式を確認（装飾的な`====`は避ける）
- "Unexpected token"
  → 構文を確認（括弧の対応等）

## テスト結果の記録

各テストを実行したら、以下の表を埋めてください：

| テスト項目 | 成功/失敗 | 備考 |
|-----------|----------|------|
| 構文ハイライト | ⬜ | |
| オートコンプリート | ⬜ | |
| グローバル初期化 | ⬜ | |
| キックドラム再生 | ⬜ | |
| ハイハット追加 | ⬜ | |
| パターン変更 | ⬜ | |
| テンポ変更 | ⬜ | |
| ミュート/アンミュート | ⬜ | |
| 停止 | ⬜ | |

## 次のステップ

テストが完了したら：
1. 結果を報告（成功/失敗/問題点）
2. パフォーマンスメトリクス（レイテンシ、安定性）を記録
3. 改善提案をまとめる

---

*テストを楽しんでください！🎵*
