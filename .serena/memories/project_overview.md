# OrbitScore プロジェクト概要

## プロジェクト説明

OrbitScoreは、度数ベースの音楽DSLを持つライブコーディング用オーディオエンジンです。SuperColliderとの統合、カスタムDSL、VS Code拡張機能を含む包括的な音楽制作環境を提供します。

## 技術スタック

- **言語**: TypeScript
- **オーディオエンジン**: SuperCollider
- **アーキテクチャ**: モノレポ構成
- **パッケージ**: engine, parser, vscode-extension
- **テスト**: vitest（115/130テスト通過）

## 現在の状況（2025-01-07更新）

### ✅ 完了したフェーズ
- **Phase 1-7**: 全リファクタリング完了（約2,000行のコードベース改善）
- **SuperCollider一本化**: Web Audio APIからSuperColliderへの完全移行
- **型安全性向上**: `any`型の使用を最小限に削減
- **未使用コード削除**: 重複ファイル、非推奨コードの完全削除
- **VS Code拡張機能**: パッケージ化修正完了
- **Git Workflow**: 包括的な開発ワークフロー実装完了
- **ブランチ保護**: main/developブランチの完全保護設定完了
- **Worktree**: 本番環境分離（orbitscore-main/）設定完了
- **Cursor BugBot**: 日本語レビュー、プロジェクト固有ガイドライン設定完了

### 🎯 現在のフェーズ
- **開発環境**: 安定したGit Workflowで通常の機能開発準備完了
- **本番環境**: 保護されたmainブランチで常に安定状態を維持
- **コードベース**: 完全にリファクタリング済み、型安全、保守性向上

### 📋 次の優先事項
- 通常の機能開発に戻る
- ライブパフォーマンスでの安定性を維持しながら新機能開発
- グラニュラーシンセシス対応の検討

## アーキテクチャ

### DSL設計
- **仕様書**: `docs/INSTRUCTION_ORBITSCORE_DSL.md`（v2.0）が最新
- **特徴**: 度数ベース、メソッドチェーン、`play()`メソッドのネスト構造
- **精度**: 小数第3位まで

### SuperCollider統合
- **SynthDef**: `packages/engine/supercollider/synthdefs/`に配置
- **setup.scd**: SynthDef生成スクリプト
- **オーディオデバイス**: 入力/出力/duplexの明確な分類

### リファクタリング成果
- **モジュール化**: 全ファイルが50行以下の関数で構成
- **型安全性**: `AudioEngine`インターフェース、`Scheduler`インターフェース拡張
- **保守性**: 未使用コード削除、重複排除、明確なディレクトリ構造
- **テスト**: 115 tests passed, 15 skipped

## 開発ワークフロー

### ブランチ構造
- **main**: 本番環境（完全保護）
- **develop**: 統合ブランチ（完全保護）
- **feature/**: 機能開発ブランチ

### 保護ルール
- PR必須、承認必須、管理者強制適用
- Cursor BugBotによる日本語レビュー
- ライブパフォーマンスの安定性を最優先

### Worktree
- **orbitscore/**: develop + feature branches（開発作業）
- **orbitscore-main/**: main branch（本番確認用）

## 完了したリファクタリング

### 主要な改善
- **コードベース削減**: 約2,000行の削減
- **型安全性**: `any`型使用を最小限に削減
- **保守性**: モジュール化、依存関係の明確化
- **テスト**: 全テストが通過、型安全な実装

### 削除されたファイル
- 未使用のスケジューラーファイル（重複）
- 非推奨のラッパークラス
- Web Audio API関連コード（SuperCollider一本化）

### 追加された機能
- `AudioEngine`インターフェース
- 拡張された`Scheduler`インターフェース
- 型安全な実装
- 自動一時ファイル管理