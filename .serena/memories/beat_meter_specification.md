# Beat/Meter Specification - 拍子記号の仕様

## 現在の実装（v2.0）
- 構文: `beat(n1 by n2)` - n1=分子、n2=分母
- 分母に制限なし（任意の正の数値を受け入れる）
- 数学的には正しく計算されるが、音楽理論的な妥当性は検証されない

## 将来の改善計画（Phase 2以降）

### 分母の制約
- **許可する値**: 1, 2, 4, 8, 16, 32, 64, 128（2のべき乗のみ）
- **理由**: 音楽理論上の拍子記号の分母は通常2のべき乗
- **排除する例**: 8/9, 5/7, 4/3など（音楽理論上解釈が困難）

### 小節長の計算
```
4分音符の長さ = 60000 / tempo (ms)
1小節の長さ = (60000 / tempo) × (numerator / denominator × 4) (ms)
```

**例**:
- `tempo(60) beat(4 by 4)` → 1小節 = 4000ms（1拍=1秒）
- `tempo(60) beat(7 by 8)` → 1小節 = 3500ms（8分音符=500ms）
- `tempo(120) beat(5 by 4)` → 1小節 = 2500ms

### ポリメーター機能
各シーケンスが独立した拍子を持ち、小節線が徐々にずれる：

```js
global.tempo(60)
global.beat(4 by 4)        // 1小節 = 4秒
seq1.beat(5 by 4)          // 1小節 = 5秒
// → 位相がずれてパターンが回り込む
```

### 用語の改善案
- `tempo()` → `bpm()`へのエイリアス追加
- 理由: BPM（Beats Per Minute）はより一般的で理解しやすい
- 実装: 両方サポートし、後方互換性を維持

## Phase 2での実装予定
1. パーサーで分母を検証（2のべき乗のみ許可）
2. エラーメッセージ追加
3. テストケース追加（正常系・異常系）
4. ドキュメント更新

## 現時点の方針
- Phase 1では厳密な制約を課さず、柔軟性を優先
- ポリメーター機能の動作を優先
- Phase 2以降で段階的に厳密化

## 詳細ドキュメント
`docs/BEAT_METER_SPECIFICATION.md`を参照
