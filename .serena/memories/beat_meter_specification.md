# Beat/Meter Specification - 拍子記号の仕様

## 現在の実装（v2.0）
- 構文: `beat(n1 by n2)` - n1=分子、n2=分母
- **分母に制限なし**（任意の正の数値を受け入れる）
- 数学的には正しく計算される

## 将来の方針（Phase 2以降）

### 分母の制約 - 2のべき乗に制限
**許可される値**: 1, 2, 4, 8, 16, 32, 64, 128（2のべき乗のみ）

**理由**:
- **音楽理論の枠組みを維持**: 既存の音楽家が`4/4, 120bpm`を見て「1分間に120回ビートが刻まれる速さの4分音符を基礎としてその4つ分が1小節」と即座に理解できる
- **計算の直感性**: `4/5`のような表記は音楽家にとって計算が困難
- **MIDIサポートとの整合性**: 将来的なMIDI出力時に標準的な拍子記号として正しく表現される
- **ICMC等での実績**: 4/4と5/4の位相ずれ（最小公倍数）は既に実績があり、演奏難易度も適切
- **過度な拡張の回避**: 音楽理論の枠組みを逸脱しすぎない

### 小節長の計算
```
4分音符の長さ = 60000 / tempo (ms)
1小節の長さ = (60000 / tempo) × (numerator / denominator × 4) (ms)
```

**例**:
- `tempo(60) beat(4 by 4)` → 1小節 = 4000ms
- `tempo(60) beat(7 by 8)` → 1小節 = 3500ms
- `tempo(60) beat(5 by 4)` → 1小節 = 5000ms

### ポリメーター機能
各シーケンスが独立した拍子を持ち、小節線が徐々にずれる：

```js
global.tempo(60)
global.beat(4 by 4)        // 1小節 = 4秒
seq1.beat(5 by 4)          // 1小節 = 5秒
// → 位相がずれてパターンが回り込む（20秒後に再同期）
```

### 用語の改善案
- `tempo()` → `bpm()`へのエイリアス追加
- 理由: BPM（Beats Per Minute）はより一般的で理解しやすい
- 実装: 両方サポートし、後方互換性を維持

## Phase 2での実装予定
1. パーサーで分母を検証（2のべき乗のみ許可）
2. 分母が不正な場合のエラーメッセージ
3. テストケース追加（正常系・異常系）
4. `bpm()`メソッドの追加（`tempo()`のエイリアス）

## 現時点の方針
- **Phase 1**: 厳密な制約を課さず、柔軟性を優先
- **理由**: ポリメーター機能の動作を優先、実験的な使用を妨げない
- **Phase 2**: 2のべき乗の制約を導入し、音楽理論の枠組みを維持

## 詳細ドキュメント
`docs/BEAT_METER_SPECIFICATION.md`を参照
